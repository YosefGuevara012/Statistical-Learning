---
title: "Lab: Logistic Regression, LDA, QDA, and KNN"
output: html_notebook
---


###4.6.1 The Stock Market Data

We will begin by examining some numerical and graphical summaries of
the Smarket data, which is part of the ISLR library. This data set consists of
percentage returns for the S&P 500 stock index over 1, 250 days, from the
beginning of 2001 until the end of 2005. For each date, we have recorded
the percentage returns for each of the five previous trading days, Lag1
through Lag5. We have also recorded Volume (the number of shares traded on the previous day, in billions), Today (the percentage return on the date in question) and Direction (whether the market was Up or Down on this
date).

```{r}
library(ISLR)
names(Smarket)
```

```{r}
dim(Smarket )
```

```{r}
summary (Smarket )
```
The cor() function produces a matrix that contains all of the pairwise
correlations among the predictors in a data set. The first command below
gives an error message because the Direction variable is qualitative.

```{r}
cor(Smarket[,-9])
```
As one would expect, the correlations between the lag variables and today’s
returns are close to zero. In other words, there appears to be little
correlation between today’s returns and previous days’ returns. The only
substantial correlation is between Year and Volume. By plotting the data we
see that Volume is increasing over time. In other words, the average number
of shares traded daily increased from 2001 to 2005.

```{r}
attach (Smarket)
plot(Volume )
```
### 4.6.2 Logistic Regression

Next, we will fit a logistic regression model in order to predict Direction
using Lag1 through Lag5 and Volume. The glm() function fits generalized
glm()
linear models, a class of models that includes logistic regression. The syntax
generalized
of the glm() function is similar to that of lm(), except that we must pass in linear model
the argument family=binomial in order to tell R to run a logistic regression
rather than some other type of generalized linear model.

```{r}
glm.fit=glm(Direction ~ Lag1+Lag2+Lag3+Lag4+Lag5+Volume ,family =binomial )
summary (glm.fit )
```
The smallest p-value here is associated with Lag1. The negative coefficient
for this predictor suggests that if the market had a positive return yesterday,
then it is less likely to go up today. However, at a value of 0.15, the p-value
is still relatively large, and so there is no clear evidence of a real association
between Lag1 and Direction.

We use the coef() function in order to access just the coefficients for this
fitted model. We can also use the summary() function to access particular
aspects of the fitted model, such as the p-values for the coefficients.


```{r}
coef(glm.fit)
```

```{r}
summary (glm.fit )$coef
```
The predict() function can be used to predict the probability that the
market will go up, given values of the predictors. The type="response"
option tells R to output probabilities of the form P(Y = 1|X), as opposed
to other information such as the logit. If no data set is supplied to the
predict() function, then the probabilities are computed for the training
data that was used to fit the logistic regression model. Here we have printed
only the first ten probabilities. We know that these values correspond to
the probability of the market going up, rather than down, because the
contrasts() function indicates that R has created a dummy variable with
a 1 for Up.

```{r}
glm.probs = predict(glm.fit ,type ="response")
glm.probs [1:10]
```
```{r}
contrasts(Direction)
```
In order to make a prediction as to whether the market will go up or
down on a particular day, we must convert these predicted probabilities
into class labels, Up or Down. The following two commands create a vector
of class predictions based on whether the predicted probability of a market
increase is greater than or less than 0.5.

```{r}
glm.pred=rep ("Down" ,1250)
glm.pred[glm.probs >.5]="Up"
```

The first command creates a vector of 1,250 Down elements. The second line
transforms to Up all of the elements for which the predicted probability of a
market increase exceeds 0.5. Given these predictions, the table() function
table()
can be used to produce a confusion matrix in order to determine how many
observations were correctly or incorrectly classified.


```{r}
table(glm.pred ,Direction )
```

```{r}
(507+145) /1250
```

```{r}
mean(glm.pred == Direction)

```



